function agregarTotal(){var a=0,e=0;$("#Cotizaciones-grid tbody tr .precio_total").each(function(o,t){a+=parseFloat($(this).text()),e+=parseFloat($(this).text())}),(a>0||e>0)&&(e/=IVA,$("#tabla_total #campo_subtotal").text(e.toFixed(2)),$("#tabla_total #campo_total").text(a.toFixed(2)))}const IVA=1.16;$(document).ready(function(){agregarTotal(),$("#btn_guardar").click(function(){var a=$("#token_input").attr("value");$.ajax({url:"index.php?r=Joyeria/cotizaciones/index",data:{token:a,guardar:1},type:"GET",beforeSend:function(){$.blockUI({message:'<strong><img src="../cotizador/images/cargando.png" /> Guardando...</strong>'})},success:function(a){var a=$.parseJSON(a);1==a.error?($("#controles_cotizacion").css("display","none"),$("#mensaje_validacion_error").css("display","block"),$("#mensaje_validacion_correcto").css("display","none"),$("#mensaje_validacion_error #mensaje_valor").empty(),$("#mensaje_validacion_error #mensaje_valor").append(a.mensaje)):($("#controles_cotizacion").css("display","block"),$("#mensaje_validacion_correcto").css("display","block"),$("#mensaje_validacion_error").css("display","none"),$("#mensaje_validacion_correcto #mensaje_valor").empty(),$("#mensaje_validacion_correcto #mensaje_valor").append(a.mensaje))},error:function(){$("#controles_cotizacion").css("display","none"),smoke.alert("Ha ocurrido Error, intente más tarde",function(a){},{ok:"Aceptar",classname:"custom-class"})},complete:function(){$.unblockUI()}})}),$("#agregarProducto").click(function(){$("#mydialog").dialog("open"),$("dialog[role='dialog']").css("left","0px");var a="Productos-grid",e="#"+a+" .filters input, #"+a+" .filters select";$(e).each(function(a,e){$(e).val("")});var o=$.param($(e));return $.fn.yiiGridView.update(a,{data:o}),!1}),$("#btnPorcentajeGlobal").click(function(){if(""!=$("#porcentajeGlobal").val()){var a=$("#porcentajeGlobal").val(),e=[],o=0;$("#Cotizaciones-grid table.items tr").each(function(a){$("td",this).each(function(t){a>1&&2==t&&(e[o]=$(this).find(".idCotOculto").val(),o++)})}),$.ajax({url:"index.php?r=Joyeria/productos/seleccionProductos",data:{arrayIdCotizaciones:e,porcentajeGlobal:1,cantidadPorcentaje:a},type:"POST",success:function(a){$.fn.yiiGridView.update("Cotizaciones-grid",{complete:function(a,e){"success"==e&&($("#Cotizaciones-grid select").attr("value","empty"),agregarTotal())}}),smoke.alert("Porcentaje Aplicado",function(a){},{ok:"Aceptar",classname:"custom-class"})},error:function(){smoke.alert("Ha ocurrido un problema, intente más tarde",function(a){},{ok:"Aceptar",classname:"custom-class"})}})}else smoke.alert("Debe ingresar un dígito del 1 al 100",function(a){},{ok:"Aceptar",classname:"custom-class"})})});